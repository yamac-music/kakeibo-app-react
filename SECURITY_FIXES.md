# セキュリティ問題修正タスクリスト

このドキュメントは、React家計簿アプリケーションで発見されたセキュリティ問題とその修正計画をまとめています。

## 🔴 緊急対応が必要（高リスク）

### 1. Firebase設定情報の露出防止
- **問題**: `src/firebase.js:7-15`でFirebase設定の詳細がコンソールに出力される
- **リスク**: プロジェクトIDなどの機密情報がブラウザコンソールに露出
- **修正内容**:
  - [ ] 本番環境でのコンソール出力を削除
  - [ ] プロジェクトIDの直接出力を停止
  - [ ] 必要に応じて開発環境のみでの出力に制限
- **対象ファイル**: `src/firebase.js`
- **優先度**: 🔴 最高

### 2. 認証バイパス問題の修正
- **問題**: Firebase未設定時に認証をバイパスしてアプリケーション全体にアクセス可能
- **リスク**: 認証なしでデータ操作が可能
- **修正内容**:
  - [ ] Firebase未設定時は制限付きデモモードに変更
  - [ ] デモモード時のデータ永続化を無効化
  - [ ] デモモード表示の明確化
  - [ ] デモモードでの機能制限を実装
- **対象ファイル**: `src/App.jsx`, `src/components/auth/PrivateRoute.jsx`
- **優先度**: 🔴 最高

## 🟡 早期対応が必要（中リスク）

### 3. 自動ログアウト機構の実装
- **問題**: 非アクティブ時の自動ログアウト機構が未実装
- **リスク**: 共有端末でのセッション残存、長時間放置時の不正アクセス
- **修正内容**:
  - [ ] アイドル時間検出機能の実装（デフォルト: 30分）
  - [ ] ユーザーアクティビティ監視（マウス移動、キーボード入力、クリック）
  - [ ] 自動ログアウト前の警告表示（5分前）
  - [ ] セッション延長オプションの提供
  - [ ] 設定画面でのタイムアウト時間変更機能
- **対象ファイル**: `src/contexts/AuthContext.jsx`, `src/hooks/useIdleTimer.js`（新規作成）
- **優先度**: 🟡 高

### 4. エラー情報露出の防止
- **問題**: 詳細なエラー情報がコンソールとアラートに出力される
- **リスク**: システム内部情報の露出
- **修正内容**:
  - [ ] 本番環境での詳細エラー情報を削除
  - [ ] スタックトレースの出力を停止
  - [ ] ユーザー向けの一般的なエラーメッセージに変更
  - [ ] 開発環境のみでの詳細ログ出力
- **対象ファイル**: `src/components/Home.jsx:190, 216-224`
- **優先度**: 🟡 高

### 5. 入力値検証の強化
- **問題**: 入力値の検証が不十分
- **リスク**: 不正なデータの挿入、システム負荷
- **修正内容**:
  - [ ] 金額の上限値設定（例: 10,000,000円）
  - [ ] 文字列の長さ制限（説明文: 100文字以内）
  - [ ] 特殊文字のサニタイゼーション
  - [ ] 数値の型チェック強化
- **対象ファイル**: `src/components/Home.jsx`（入力フォーム部分）
- **優先度**: 🟡 高

### 6. localStorage暗号化の実装
- **問題**: localStorage使用時のデータ暗号化が未実装
- **リスク**: ブラウザ経由でのデータ取得
- **修正内容**:
  - [ ] データ暗号化ライブラリの追加
  - [ ] 保存時の暗号化処理
  - [ ] 読み込み時の復号化処理
  - [ ] 暗号化キーの管理
- **対象ファイル**: localStorage関連のファイル
- **優先度**: 🟡 高

## 🟢 改善が望ましい（低リスク）

### 7. Firestoreセキュリティルールの最適化
- **問題**: セキュリティルールが複雑で理解しにくい
- **リスク**: 設定ミスによる意図しないアクセス許可
- **修正内容**:
  - [ ] ルールの簡素化と明確化
  - [ ] 重複ルールの統合
  - [ ] セキュリティルールのテスト追加
  - [ ] ドキュメント化
- **対象ファイル**: `firestore.rules`
- **優先度**: 🟢 中

### 8. CSRF対策の実装
- **問題**: CSRF攻撃に対する明示的な対策が不足
- **リスク**: 悪意のあるサイトからの操作実行
- **修正内容**:
  - [ ] Firebase Authenticationによる自動的なCSRF保護の確認
  - [ ] 必要に応じて追加のトークン検証
  - [ ] SameSite cookieの設定確認
- **対象ファイル**: 認証関連ファイル全般
- **優先度**: 🟢 中

### 9. セキュリティヘッダーの追加
- **問題**: セキュリティヘッダーが不足している可能性
- **リスク**: XSS、clickjacking等の攻撃
- **修正内容**:
  - [ ] Content Security Policy (CSP)の設定
  - [ ] X-Frame-Optionsの設定
  - [ ] X-XSS-Protectionの設定
  - [ ] Referrer-Policyの設定
- **対象ファイル**: `index.html`, デプロイ設定
- **優先度**: 🟢 中

## 🔍 セキュリティ監査項目

### 定期的に確認が必要な項目
- [ ] 依存関係の脆弱性チェック（`npm audit`）
- [ ] Firebaseセキュリティルールのテスト
- [ ] 認証フローの動作確認
- [ ] ログ出力の監査
- [ ] 入力検証の動作確認

## 📋 修正スケジュール

### フェーズ1（緊急対応）- 完了目標: 1週間以内
1. Firebase設定情報の露出防止
2. 認証バイパス問題の修正

### フェーズ2（早期対応）- 完了目標: 2週間以内
3. 自動ログアウト機構の実装
4. エラー情報露出の防止
5. 入力値検証の強化
6. localStorage暗号化の実装

### フェーズ3（改善実装）- 完了目標: 1ヶ月以内
7. Firestoreセキュリティルールの最適化
8. CSRF対策の実装
9. セキュリティヘッダーの追加

## 📝 注意事項

- 修正作業前に必ずバックアップを取得すること
- 本番環境での変更は慎重に行い、段階的にリリースすること
- 各修正後は必ずテストを実行し、機能が正常に動作することを確認すること
- セキュリティ修正による機能への影響を事前に評価すること

---

**最終更新日**: 2025-06-29
**作成者**: Claude Code セキュリティ分析